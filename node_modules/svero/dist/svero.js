"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var internal=require("svelte/internal"),store=require("svelte/store"),svelte=require("svelte"),defaultExport=function(e){function t(t,n){var r="Unreachable '"+t+"', segment '"+n+"' is not defined";e.call(this,r),this.message=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error);function buildMatcher(e,t){var n,r,a=-100,o=[];n=e.replace(/[-$.]/g,"\\$&").replace(/\(/g,"(?:").replace(/\)/g,")?").replace(/([:*]\w+)(?:<([^<>]+?)>)?/g,function(e,t,n){return o.push(t.substr(1)),":"===t.charAt()?(a+=100,"((?!#)"+(n||"[^/]+?")+")"):(r=!0,a+=500,"((?!#)"+(n||".+?")+")")});try{n=new RegExp("^"+n+"$")}catch(e){throw new TypeError("Invalid route expression, given '"+t+"'")}var i=e.includes("#")?.5:1,c=e.length*a*i;return{keys:o,regex:n,_depth:c,_isSplat:r}}var PathMatcher=function(e,t){var n=buildMatcher(e,t),r=n.keys,a=n.regex,o=n._depth;return{_isSplat:n._isSplat,_depth:o,match:function(e){var t=e.match(a);if(t)return r.reduce(function(e,n,r){return e[n]="string"==typeof t[r+1]?decodeURIComponent(t[r+1]):null,e},{})}}};function merge(e,t){return""+(t&&"/"!==t?t:"")+(e||"")}function walk(e,t){var n=e.match(/<[^<>]*\/[^<>]*>/);if(n)throw new TypeError("RegExp cannot contain slashes, given '"+n+"'");var r="/"!==e?e.split("/"):[""],a=[];r.some(function(e,n){var o=a.concat(e).join("/")||null,i=r.slice(n+1).join("/")||null,c=t("/"+e,o,i?(e?"/"+e:"")+"/"+i:null);return a.push(e),c})}function reduce(e,t,n){var r,a={},o=[];return walk(e,function(i,c,s){var l;if(!t.keys)throw new defaultExport(e,i);if(t.keys.some(function(e){if(n.includes(e))return!1;var u=t[e].pattern,p=u.match,f=u._isSplat,d=p(f&&s||i);return!!d&&(Object.assign(a,d),t[e].route&&o.push(Object.assign({},t[e].info,{matches:i===c||f||!s,params:Object.assign({},a),route:t[e].route,path:f?s:c||i})),null===s&&!t[e].keys||("/"!==e&&n.push(e),r=f,t=t[e],l=!0,!0))}),!l&&!t.keys.some(function(e){return t[e].pattern.match(i)}))throw new defaultExport(e,i);return r||!l}),o}function find(e,t,n){for(var r=reduce.bind(null,e,t),a=[];n>0;){n-=1;try{return r(a)}catch(e){if(n>0)return r(a);throw e}}}function add(e,t,n,r){var a=merge(e,n),o=t;return walk(a,function(e,t){o=PathMatcher.push(e,o,t,a),"/"!==e&&(o.info=o.info||Object.assign({},r))}),o.info=o.info||Object.assign({},r),a}function rm(e,t,n){var r=merge(e,n),a=t,o=null,i=null;if(walk(r,function(n){if(!a)return o=null,!0;if(i=n,!(o="/"===n?t["/"]:a).keys)throw new defaultExport(e,n);a=a[n]}),!o||!i)throw new defaultExport(e,i);delete o[i],"/"===i&&(delete o.info,delete o.route),-1!==o.keys.indexOf(i)&&(o.keys.splice(o.keys.indexOf(i),1),PathMatcher.sort(o))}PathMatcher.push=function(e,t,n,r){var a=t[e]||(t[e]={});return a.pattern||(a.pattern=new PathMatcher(e,r),a.route=n||"/"),t.keys=t.keys||[],t.keys.includes(e)||(t.keys.push(e),PathMatcher.sort(t)),a},PathMatcher.sort=function(e){e.keys.sort(function(t,n){return e[t].pattern._depth-e[n].pattern._depth})};var Router=function(){var e={},t=[];return{mount:function(e,n){"/"!==e&&t.push(e),n(),t.pop()},find:function(t,n){return find(t,e,!0===n?2:n||1)},add:function(n,r){return add(n,e,t.join(""),r)},rm:function(n){return rm(n,e,t.join(""))}}};const CTX_ROUTER={};function navigateTo(e){if(!e||"string"!=typeof e)throw Error(`svero expects navigateTo() to have a string parameter. The parameter provided was: ${e} of type ${typeof e} instead.`);if("/"!==e[0]&&"#"!==e[0])throw Error(`svero expects navigateTo() param to start with slash or hash, e.g. "/${e}" or "#${e}" instead of "${e}".`);history.pushState&&window.dispatchEvent?(history.pushState({},"",e),window.dispatchEvent(new Event("popstate"))):window.location.href=e}function create_if_block(e){var t,n,r,a,o,i,c;return{c(){t=internal.element("fieldset"),n=internal.element("legend"),r=internal.text("Router failure: "),a=internal.text(e.path),o=internal.space(),i=internal.element("pre"),c=internal.text(e.failure)},m(e,s){internal.insert(e,t,s),internal.append(t,n),internal.append(n,r),internal.append(n,a),internal.append(t,o),internal.append(t,i),internal.append(i,c)},p(e,t){e.path&&internal.set_data(a,t.path),e.failure&&internal.set_data(c,t.failure)},d(e){e&&internal.detach(t)}}}function create_fragment(e){var t,n,r,a=e.failure&&!e.nofallback&&create_if_block(e);const o=e.$$slots.default,i=internal.create_slot(o,e,null);return{c(){a&&a.c(),t=internal.space(),i&&i.c(),r=internal.listen(window,"popstate",e.handlePopState)},l(e){i&&i.l(e)},m(e,r){a&&a.m(e,r),internal.insert(e,t,r),i&&i.m(e,r),n=!0},p(e,n){n.failure&&!n.nofallback?a?a.p(e,n):((a=create_if_block(n)).c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),i&&i.p&&e.$$scope&&i.p(internal.get_slot_changes(o,n,e,null),internal.get_slot_context(o,n,null))},i(e){n||(i&&i.i&&i.i(e),n=!0)},o(e){i&&i.o&&i.o(e),n=!1},d(e){a&&a.d(e),e&&internal.detach(t),i&&i.d(e),r()}}}const router=new Router;function cleanPath(e){return e.replace(/\?[^#]*/,"").replace(/(?!^)\/#/,"#").replace("/#","#").replace(/\/$/,"")}function fixPath(e){return"/#*"===e||"#*"===e?"#*_":"/*"===e||"*"===e?"/*_":e}function instance(e,t,n){let r,a,o,i,c,{path:s="/",nofallback:l=null}=t;const u=store.writable({});internal.subscribe(e,u,e=>{n("$routeInfo",r=e)});const p=svelte.getContext(CTX_ROUTER),f=p?p.basePath:store.writable(s);function d(e){const t=e.reduce((e,t)=>(e[t.key]=Object.assign(e[t.key]||{},t.params),e),{});let n,a={};e.some(e=>{if("boolean"==typeof e.condition||"function"==typeof e.condition){if(!1===("function"==typeof e.condition?e.condition():e.condition)&&e.redirect)return navigateTo(e.redirect),n=!0,!0}if(e.key&&!a[e.key]){if(e.exact&&!e.matches)return!1;a[e.key]={...e,params:t[e.key]}}return!1}),n||(r=a,u.set(r))}function h(e,t){r[c]={failure:e,params:{_:t.substr(1)||void 0}},u.set(r)}function $(){const e=cleanPath(`/${location.href.split("/").slice(3).join("/")}`);try{const t=function(e){const t=e.split("#")[0].split("/"),n=[],r=[];return t.forEach(t=>{const a=n.concat(`/${t}`).join("");t&&n.push(`/${t}`);try{const t=router.find(a);d(t),r.push(...t)}catch(t){h(t,e)}}),r}(e);if(e.includes("#")){const n=router.find(e),r={};d(t.concat(n).reduce((e,t)=>(void 0===r[t.key]&&(r[t.key]=e.length),e[r[t.key]]=t,e),[]))}}catch(t){if(!c)return void n("failure",i=t);h(t,e)}}function _(){clearTimeout(o),o=setTimeout($,100)}internal.subscribe(e,f,e=>{n("$basePath",a=e)}),svelte.setContext(CTX_ROUTER,{basePath:f,routeInfo:u,assignRoute:function(e,t,n){e=e||Math.random().toString(36).substr(2);const r=a!==s&&"/"!==a?`${a}${s}`:s,o={key:e,...n};let i;return router.mount(r,()=>{i=router.add(fixPath(t),o),c=o.fallback&&e||c}),_(),[e,i]},unassignRoute:function(e){router.rm(fixPath(e)),_()}});let{$$slots:m={},$$scope:v}=t;return e.$set=e=>{"path"in e&&n("path",s=e.path),"nofallback"in e&&n("nofallback",l=e.nofallback),"$$scope"in e&&n("$$scope",v=e.$$scope)},{failure:i,path:s,nofallback:l,routeInfo:u,basePath:f,handlePopState:$,$$slots:m,$$scope:v}}class Router_1 extends internal.SvelteComponent{constructor(e){super(),internal.init(this,e,instance,create_fragment,internal.safe_not_equal,["path","nofallback"])}}const get_default_slot_changes=({activeRouter:e,activeProps:t})=>({router:e,props:t}),get_default_slot_context=({activeRouter:e,activeProps:t})=>({router:e,props:t});function create_if_block$1(e){var t,n,r,a,o=[create_if_block_1,create_else_block],i=[];function c(e){return e.component?0:1}return t=c(e),n=i[t]=o[t](e),{c(){n.c(),r=internal.empty()},m(e,n){i[t].m(e,n),internal.insert(e,r,n),a=!0},p(e,a){var s=t;(t=c(a))===s?i[t].p(e,a):(internal.group_outros(),internal.on_outro(()=>{i[s].d(1),i[s]=null}),n.o(1),internal.check_outros(),(n=i[t])||(n=i[t]=o[t](a)).c(),n.i(1),n.m(r.parentNode,r))},i(e){a||(n&&n.i(),a=!0)},o(e){n&&n.o(),a=!1},d(e){i[t].d(e),e&&internal.detach(r)}}}function create_else_block(e){var t;const n=e.$$slots.default,r=internal.create_slot(n,e,get_default_slot_context);return{c(){r&&r.c()},l(e){r&&r.l(e)},m(e,n){r&&r.m(e,n),t=!0},p(e,t){r&&r.p&&(e.$$scope||e.activeRouter||e.activeProps)&&r.p(internal.get_slot_changes(n,t,e,get_default_slot_changes),internal.get_slot_context(n,t,get_default_slot_context))},i(e){t||(r&&r.i&&r.i(e),t=!0)},o(e){r&&r.o&&r.o(e),t=!1},d(e){r&&r.d(e)}}}function create_if_block_1(e){var t,n,r=[{router:e.activeRouter},e.activeProps],a=e.component;function o(e){let t={};for(var n=0;n<r.length;n+=1)t=internal.assign(t,r[n]);return{props:t}}if(a)var i=new a(o());return{c(){i&&i.$$.fragment.c(),t=internal.empty()},m(e,r){i&&internal.mount_component(i,e,r),internal.insert(e,t,r),n=!0},p(e,n){var c=e.activeRouter||e.activeProps?internal.get_spread_update(r,[e.activeRouter&&{router:n.activeRouter},e.activeProps&&n.activeProps]):{};if(a!==(a=n.component)){if(i){internal.group_outros();const e=i;internal.on_outro(()=>{e.$destroy()}),e.$$.fragment.o(1),internal.check_outros()}a?((i=new a(o())).$$.fragment.c(),i.$$.fragment.i(1),internal.mount_component(i,t.parentNode,t)):i=null}else a&&i.$set(c)},i(e){n||(i&&i.$$.fragment.i(e),n=!0)},o(e){i&&i.$$.fragment.o(e),n=!1},d(e){e&&internal.detach(t),i&&i.$destroy(e)}}}function create_fragment$1(e){var t,n,r=e.activeRouter&&create_if_block$1(e);return{c(){r&&r.c(),t=internal.empty()},m(e,a){r&&r.m(e,a),internal.insert(e,t,a),n=!0},p(e,n){n.activeRouter?r?(r.p(e,n),r.i(1)):((r=create_if_block$1(n)).c(),r.i(1),r.m(t.parentNode,t)):r&&(internal.group_outros(),internal.on_outro(()=>{r.d(1),r=null}),r.o(1),internal.check_outros())},i(e){n||(r&&r.i(),n=!0)},o(e){r&&r.o(),n=!1},d(e){r&&r.d(e),e&&internal.detach(t)}}}function getProps(e,t){const{props:n,...r}=e;return t.forEach(e=>{delete r[e]}),{...n,...r}}function instance$1(e,t,n){let r,{key:a=null,path:o="",props:i=null,exact:c,fallback:s,component:l,condition:u,redirect:p}=t;const{assignRoute:f,unassignRoute:d,routeInfo:h}=svelte.getContext(CTX_ROUTER);internal.subscribe(e,h,e=>{n("$routeInfo",r=e)});let $,_=null,m={};[a,$]=f(a,o,{condition:u,redirect:p,fallback:s,exact:c}),n("key",a),svelte.onDestroy(()=>{d($)});let{$$slots:v={},$$scope:g}=t;return e.$set=e=>{n("$$props",t=internal.assign(internal.assign({},t),e)),"key"in t&&n("key",a=t.key),"path"in t&&n("path",o=t.path),"props"in t&&n("props",i=t.props),"exact"in t&&n("exact",c=t.exact),"fallback"in t&&n("fallback",s=t.fallback),"component"in t&&n("component",l=t.component),"condition"in t&&n("condition",u=t.condition),"redirect"in t&&n("redirect",p=t.redirect),"$$scope"in e&&n("$$scope",g=e.$$scope)},e.$$.update=(e={$routeInfo:1,key:1,$$props:1})=>{(e.$routeInfo||e.key)&&(n("activeRouter",_=r[a]),n("activeProps",m=getProps(t,arguments[0].$$.props)))},{key:a,path:o,props:i,exact:c,fallback:s,component:l,condition:u,redirect:p,routeInfo:h,activeRouter:_,activeProps:m,$$props:t=internal.exclude_internal_props(t),$$slots:v,$$scope:g}}class Route extends internal.SvelteComponent{constructor(e){super(),internal.init(this,e,instance$1,create_fragment$1,internal.safe_not_equal,["key","path","props","exact","fallback","component","condition","redirect"])}}function create_fragment$2(e){var t,n,r;const a=e.$$slots.default,o=internal.create_slot(a,e,null);return{c(){t=internal.element("a"),o&&o.c(),t.href=e.href,t.className=e.className,r=internal.listen(t,"click",internal.prevent_default(e.onClick))},l(e){o&&o.l(a_nodes)},m(e,r){internal.insert(e,t,r),o&&o.m(t,null),n=!0},p(e,r){o&&o.p&&e.$$scope&&o.p(internal.get_slot_changes(a,r,e,null),internal.get_slot_context(a,r,null)),n&&!e.href||(t.href=r.href),n&&!e.className||(t.className=r.className)},i(e){n||(o&&o.i&&o.i(e),n=!0)},o(e){o&&o.o&&o.o(e),n=!1},d(e){e&&internal.detach(t),o&&o.d(e),r()}}}function instance$2(e,t,n){let{class:r="",href:a="/",className:o="",title:i=""}=t;svelte.onMount(()=>{n("className",o=o||r)});const c=svelte.createEventDispatcher();let{$$slots:s={},$$scope:l}=t;return e.$set=e=>{"class"in e&&n("cssClass",r=e.class),"href"in e&&n("href",a=e.href),"className"in e&&n("className",o=e.className),"title"in e&&n("title",i=e.title),"$$scope"in e&&n("$$scope",l=e.$$scope)},{cssClass:r,href:a,className:o,title:i,onClick:function(e){let t=a;"/"!==t.charAt()&&(t=window.location.pathname+t),navigateTo(t),c("click",e)},$$slots:s,$$scope:l}}class Link extends internal.SvelteComponent{constructor(e){super(),internal.init(this,e,instance$2,create_fragment$2,internal.safe_not_equal,["class","href","className","title"])}}exports.Link=Link,exports.Route=Route,exports.Router=Router_1,exports.navigateTo=navigateTo;
